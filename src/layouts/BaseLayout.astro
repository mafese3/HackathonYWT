---
import Nav from '../components/Nav.astro'
import '../styles/global.css'

// Script que se ejecuta en el cliente para inicializar el tema
const themeScript = `
{
  // Función para inicializar el tema
  function initTheme() {
    const savedTheme = localStorage.getItem('theme') || 'light';
    document.documentElement.setAttribute('data-theme', savedTheme);
    return savedTheme;
  }

  // Función para cambiar el tema
  window.toggleTheme = function() {
    const currentTheme = document.documentElement.getAttribute('data-theme');
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    
    // Actualizar el tema
    document.documentElement.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
    
    // Actualizar todos los toggles
    document.querySelectorAll('.theme-toggle').forEach(toggle => {
      toggle.checked = newTheme === 'dark';
    });
  }

  // Inicializar tema al cargar
  document.addEventListener('DOMContentLoaded', () => {
    const currentTheme = initTheme();
    document.querySelectorAll('.theme-toggle').forEach(toggle => {
      toggle.checked = currentTheme === 'dark';
    });
  });
}
`;
---
<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <slot name="head" />
    <title> Lyra</title>
    <link rel="icon" type="image/png" href="/images/logo.png" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" />
    <script>
      /** Configura el tema inicial y expone funciones de tema */
      (function () {
        try {
          const stored = localStorage.getItem('theme');
          const prefersDark = window.matchMedia?.('(prefers-color-scheme: dark)').matches;
          const theme = stored || (prefersDark ? 'dark' : 'light');
          
          // Set initial theme
          document.documentElement.setAttribute('data-theme', theme);
          
          // Set window properties
          window.__theme = theme;
          window.toggleTheme = function () {
            const current = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'light';
            const next = current === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', next);
            localStorage.setItem('theme', next);
            window.__theme = next;
            document.dispatchEvent(new CustomEvent('themechange', { detail: { theme: next } }));
            return next;
          };
        } catch (e) {
          // silent
        }
      })();
    </script>
  </head>
  <body class="min-h-screen flex flex-col">
    <header class="theme-header shadow-lg">
      <div class="container py-4 flex items-center justify-between">
        <a href="/videos" class="flex items-center gap-3 theme-link">
          <img src="/images/logo_notext.png" alt="Lyra Logo" class="h-8 w-8" />
          <span class="text-xl font-bold" style="font-family: 'Noto Serif', serif;">LYRA</span>
        </a>
        <Nav />
      </div>
    </header>

    <main class="flex-grow" class:list={[{"container py-8": Astro.url.pathname !== "/videos"}]}>
      <slot name="content" />
    </main>

    <footer class="theme-header border-t mt-auto" class:list={[{"hidden": Astro.url.pathname === "/videos"}]}>
      <div class="container py-6 text-sm theme-text-secondary">© {new Date().getFullYear()} Lyra — Plataforma educativa para reducir la brecha de género en STEM</div>
    </footer>
  </body>
</html>